<!DOCTYPE html>
<html lang="en" ng-app="myApp">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="http://getbootstrap.com/favicon.ico">

    <title>Workforce Management System</title>

    <!--<script src="../public/javascripts/angular.min.js"></script>-->
    <script src="/javascripts/angular.min.js"></script>


    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css"/>
    <!--<link rel="stylesheet" href="../public/stylesheets/bootstrap.min.css"/>-->


    <!-- Custom styles for this template -->
    <link href="/stylesheets/dashboard.css" rel="stylesheet"/>
    <!--<link href="../public/stylesheets/dashboard.css" rel="stylesheet"/>-->


    <!-- load the google maps api-->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.20&key=AIzaSyC0jyU5LAJj16vI3cIZ0HDbo2LU6kRNwJ4&libraries=geometry"></script>
    <script src="/javascripts/google-map.js"></script>

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="/javascripts/ie-emulation-modes-warning.js"></script>
    <!--<script src="../public/javascripts/ie-emulation-modes-warning.js"></script>-->


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->


    <!--<link rel="stylesheet" href="../public/stylesheets/ng-table.min.css"/>-->
    <link rel="stylesheet" href="/stylesheets/ng-table.min.css"/>
    <!--<script src="../public/javascripts/ng-table.min.js"></script>-->
    <script src="/javascripts/ng-table.min.js"></script>

</head>

<body ng-controller="AdminCtrl">

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Admin: {{}}</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="/logout"><span class='glyphicon glyphicon-log-out'></span> Log Out</a></li>
            </ul>
            <!--<form class="navbar-form navbar-right">
                <input type="text" class="form-control" placeholder="Search...">
              </form>-->
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar" ng-init="tab = 0">
                <li ng-class="{ active:tab === 0 }"><a href ng-click="tab = 0">Overview
                    <span class="sr-only">(current)</span></a>
                </li>
                <li ng-class="{ active:tab === 1 }"><a href ng-click="tab = 1;getAllClients()">Clients</a>
                </li>
                <li ng-class="{ active:tab === 2 }"><a href ng-click="tab = 2;getAllGuards()">Guards</a>
                </li>
                <li ng-class="{ active:tab === 3 }">
                    <a href ng-click="tab = 3;getAllBuildings();loadScript()">Buildings</a>
                </li>
                <li ng-class="{ active:tab === 4 }"><a href ng-click="tab = 4;getAllReports()">Reports</a>
                </li>
                <li ng-class="{ active:tab === 5 }"><a href ng-click="tab = 5;getAllAlerts()">Alerts</a>
                </li>
            </ul>
        </div>

        <div ng-show="tab === 0" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">Welcome, Administrator!</h1>
            <!--<div id="map-canvas"></div>-->

        </div>

        <div ng-show="tab === 1" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

            <h1 class="page-header">Clients</h1>
            <label>ID: <input ng-model="search.client_id"></label> <label>First Name:
            <input ng-model="search.first_name"></label> <label>Last Name: <input ng-model="search.last_name"></label>
            <table ng-table="tableClients" class="table">
                <tr ng-repeat="user in clients_data | filter:search:strict">
                    <td data-title="'CLIENT ID'" sortable="'client_id'">
                        {{user.client_id}}
                    </td>
                    <td data-title="'FIRST NAME'" sortable="'first_name'">
                        {{user.first_name}}
                    </td>
                    <td data-title="'LAST NAME'" sortable="'last_name'">
                        {{user.last_name}}
                    </td>
                    <td data-title="'PROFILE'">
                        <a ng-click="viewClient(user)"><span class="glyphicon glyphicon-eye-open"></span></a>

                    </td>
                    <td data-title="'OWNED BUILDING'">
                        <a ng-click="viewBuildings(user)"><span class="glyphicon glyphicon-paperclip"></span></a>

                    </td>

                    <td data-title="'DELETE'">
                        <a ng-click="deleteClient(user.client_id,$index)"><span class="glyphicon glyphicon-remove"></span></a>

                    </td>
                </tr>
            </table>

            <table ng-show="clientProfile" class="table">
                <thead>
                <tr>
                    <th>{{client.first_name}}</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Client ID:</td>
                    <td> {{client.client_id}}</td>
                </tr>
                <tr>
                    <td>First Name:</td>
                    <td>{{client.first_name}}</td>
                </tr>
                <tr>
                    <td>Last Name:</td>
                    <td>{{client.last_name}}</td>
                </tr>
                <tr>
                    <td>Address:</td>
                    <td>{{client.address}}</td>
                </tr>
                <tr>
                    <td>City:</td>
                    <td>{{client.city}}</td>
                </tr>
                <tr>
                    <td>State:</td>
                    <td>{{client.state}}</td>
                </tr>
                <tr>
                    <td>ZipCode:</td>
                    <td>{{client.zip_code}}</td>
                </tr>
                <tr>
                    <td>Phone Number:</td>
                    <td>{{client.phone_number}}</td>
                </tr>
                <tr>
                    <td>Email:</td>
                    <td>{{client.email}}</td>
                </tr>

                <tr>
                    <td>Start Date:</td>
                    <td>{{client.start_date}}</td>
                </tr>
                <tr>
                    <td>End Date:</td>
                    <td>{{client.end_date}}</td>
                </tr>
                <tr>
                    <td>Monthly Service Charge:</td>
                    <td>{{client.monthly_service_charge}}</td>
                </tr>
                <tr>
                    <td>Balance:</td>
                    <td>{{client.balance}}</td>
                </tr>
                </tbody>
            </table>
            <div ng-show="clientBuildings">
                <table ng-table="TclientBuildings" class="table">
                    <tr ng-repeat="user in buildings_data">
                        <td data-title="'BUILDING ID'">
                            {{user.building_id}}
                        </td>
                        <td data-title="'BUILDING NAME'">
                            {{user.name}}
                        </td>
                        <td data-title="'ADDRESS'">
                            {{user.address}}
                        </td>
                        <td data-title="'RELEASE DATE'">
                            {{user.release_date}}
                        </td>
                        <td data-title="'SERVICE FEE'">
                            {{user.service_fee}}
                        </td>
                    </tr>
                </table>
            </div>
        
        
        </div>

        <div ng-show="tab === 2" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">Guards</h1>
            <label>Search: <input ng-model="searchGuardTxt"></label>
            <table ng-table="tableGuards" class="table">
                <tr ng-repeat="user in guards_data | filter:searchGuardTxt">
                    <td data-title="'GUARD ID'" sortable="'guard_id'">
                        {{user.guard_id}}
                    </td>
                    <td data-title="'FIRST NAME'" sortable="'first_name'">
                        {{user.first_name}}
                    </td>
                    <td data-title="'LAST NAME'" sortable="'last_name'">
                        {{user.first_name}}
                    </td>
                    <td data-title="'VIEW DETAIL'">
                        <a ng-click="viewGuard(user)"><span class="glyphicon glyphicon-eye-open"></span></a>

                    </td>
                    <td data-title="'ASSIGN BUILDING'">
                        <a ng-click="assignBuildings(user)"><span class="glyphicon glyphicon-paperclip"></span></a>

                    </td>
                    <td data-title="'DELETE'">
                        <a ng-click="deleteGuard(user.guard_id,$index)"><span class="glyphicon glyphicon-remove"></span></a>

                    </td>
                </tr>
            </table>

            <table ng-show="guardDetail" class="table">
                <thead>
                <tr>
                    <th>{{guard.first_name}}</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Guard ID:</td>
                    <td> {{guard.guard_id}}</td>
                </tr>
                <tr>
                    <td>First Name:</td>
                    <td>{{guard.first_name}}</td>
                </tr>
                <tr>
                    <td>Last Name:</td>
                    <td>{{guard.last_name}}</td>
                </tr>
                <tr>
                    <td>Address:</td>
                    <td>{{guard.address}}</td>
                </tr>
                <tr>
                    <td>City:</td>
                    <td>{{guard.city}}</td>
                </tr>
                <tr>
                    <td>State:</td>
                    <td>{{guard.state}}</td>
                </tr>
                <tr>
                    <td>ZipCode:</td>
                    <td>{{guard.zip_code}}</td>
                </tr>
                <tr>
                    <td>Phone Number:</td>
                    <td>{{guard.phone_number}}</td>
                </tr>
                <tr>
                    <td>Email:</td>
                    <td>{{guard.email}}</td>
                </tr>
                <tr>
                    <td>Start Date:</td>
                    <td>{{guard.start_date}}</td>
                </tr>
                <tr>
                    <td>End Date:</td>
                    <td>{{guard.end_date}}</td>
                </tr>
                <tr>
                    <td>Back Groud Checked:</td>
                    <td>{{guard.background_check_status}}</td>
                </tr>
                <tr>
                    <td>Responsible Buildings:</td>
                    <td>
                        <table>
                            <tr ng-repeat="guard_building in guardBuilding_data">
                                <td>{{guard_building.building_id}}</td>
                            </tr>
                        </table>
                    </td>
                </tr>
                </tbody>
            </table>
            <div ng-show="assignBuildingToGuard">
                <h5>Assign Building to Guard {{guard.guard_id}}</h5>

                <form>
                    <div class="form-group">
                        <div class="col-sm-3">
                            <label>Building</label>
                            <select ng-model="assign.building_id" ng-options="building.building_id  as building.name for building in assign_buildings" class="form-control"></select>
                        </div>
                    </div>
                </form>
                <form>
                    <div class="form-group">
                        <div class="col-sm-3">
                            <label>Week Day</label>
                            <select ng-model="assign.weekday" ng-options="weekday for weekday in weekdays" class="form-control"></select>
                        </div>
                    </div>
                </form>
                <form>
                    <div class="form-group">
                        <div class="col-sm-3">
                            <label>Start Work Time</label>
                            <input type="time" class="form-control" ng-model="assign.start_time" placeholder="00:00 AM" }>

                        </div>
                    </div>
                </form>
                <form>
                    <div class="form-group">
                        <div class="col-sm-3">
                            <label>End Work Time</label>
                            <input type="time" class="form-control" ng-model="assign.end_time" placeholder="00:00 AM" }>

                        </div>
                    </div>
                </form>

                <form>

                    <input type="button" value="Save" class="btn btn-sm btn-primary navbar-right" ng-click="assign(guard.guard_id)">
                </form>
            </div>

        </div>

        <div ng-show="tab === 3" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">

            <h1 class="page-header">Buildings<input type="button" value="Create" class="btn btn-sm btn-primary navbar-right" ng-click="showCreateBuilding()">
            </h1>

            <label>Search: <input ng-model="searchBuildingTxt"></label>

            <table ng-table="tableBuildings" class="table">
                <tr ng-repeat="user in AllBuildings_data | filter:searchBuildingTxt">
                    <td data-title="'BUILDING ID'" sortable="'building_id'">
                        {{user.building_id}}
                    </td>
                    <td data-title="'BUILDING NAME'" sortable="'building_id'">
                        {{user.name}}
                    </td>
                    <td data-title="'VIEW & EDIT'">
                        <a ng-click="showEditBuilding(user)"><span class="glyphicon glyphicon-eye-open"></span></a>
                    </td>
                    <td data-title="'DELETE'">
                        <a ng-click="deleteBuilding(user.building_id,$index)"><span class="glyphicon glyphicon-remove"></span></a>

                    </td>
                </tr>
            </table>

            <div ng-show="buildingDetail">
                <table class="table">
                    <thead>
                    <tr>
                        <th>{{building.building_id}}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Building Name:</td>
                        <td><input type='text' ng-model="building.name"></td>
                    </tr>
                    <tr>
                        <td>Release Date:</td>
                        <td><input type="text" ng-model="building.release_date"></td>
                    </tr>
                    <tr>
                        <td>Service Fee ($):</td>
                        <td><input type="text" ng-model="building.service_fee"></td>
                    </tr>
                    <tr>
                        <td>Client:</td>
                        <td>
                            <select ng-model=building.client_id ng-options="client.client_id as client.first_name+' '+client.last_name for client in clients"/>
                        </td>
                    </tr>
                    <tr>
                        <td>Address:</td>
                        <td>
                            <input id="address" type="text" ng-model="building.address" class="location-input">
                            <input type="button" value="Search" onclick="codeAddress()">
                        </td>
                    </tr>
                    <tr>
                        <td>Location:</td>
                        <td>
                            <input id="location" type="text" ng-model="building.location" class="location-input">
                            <input type="button" value="Set" onclick="setLocation()">
                            <input type="button" value="Clear" onclick="clearLocation()">
                        </td>
                    </tr>
                    <tr>
                        <td>Check Points:</td>
                        <td>
                            <input id="checkpoints" type="text" ng-model="building.check_points" class="location-input">
                            <input type="button" value="Set" onclick="setCheckPoints()">
                            <input type="button" value="Clear" onclick="clearCheckPoints()">
                        </td>
                    </tr>
                    </tbody>
                </table>
                <input type="button" value="Save" class="btn btn-sm btn-primary navbar-right" ng-click="createOrEditBuilding(building.building_id)">
            </div>
            <div id="map-canvas" ng-show="buildingDetail"></div>

        </div>

        <div ng-show="tab === 4" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">Reports</h1>

            <label>Building:
                <span class="nullable">
                    <select ng-change="pickBuilding(selectedBuilding)" ng-model="selectedBuilding" ng-options="building.building_id  as building.name for building in r_buildings_search">
                        <option value="">--Please choose a building --</option>
                    </select>
                </span>
            </label>

            <label>Client:
                <span class="nullable">
                    <select ng-change="pickClient(selectedClient)" ng-model="selectedClient" ng-options="client.client_id  as client.first_name+' '+client.last_name for client in r_clients_search">
                        <option value="">--Please choose a client --</option>
                    </select>
                </span>
            </label><br/>
            <label>Report ID: <input ng-model="search.report_id "></label><label>Guard ID:
            <input ng-model="search.guard_id "></label><label>Date: <input ng-model="search.date "></label>
            <table class="table table-hover">
                <thead>
                <th>Report ID</th>
                <th>Building ID</th>
                <th>Building Name</th>
                <th>Guard ID</th>
                <th>Guard Name</th>
                <th>Date</th>
                </thead>
                <tbody>
                <tr ng-repeat='item in pickedReports| filter:search' ng-click="getReport(item)">
                    <td>
                        {{item.report_id}}
                    </td>

                    <td>
                        {{item.building_id}}
                    </td>

                    <td>
                        {{item.name}}
                    </td>
                    <td>
                        {{item.guard_id}}
                    </td>
                    <td>
                        {{item.first_name}}&nbsp{{item.last_name}}
                    </td>
                    <td>
                        {{item.date}}
                    </td>


                </tr>
                </tbody>
            </table>
            <div ng-show="showReport" class="panel panel-default">

                <div class="panel-body">
                    <span class="pull-right"><span ng-click="showReport=false " class="glyphicon glyphicon-triangle-top"></span></span>

                    <h2>Report</h2>

                    <p>The detail of the report is as below:</p>
                    <table class="table table-bordered">

                        <tbody>
                        <tr>
                            <th class="info">Property Name</th>
                            <td>{{myReport.building_name}}</td>
                            <th class="info">Date</th>
                            <td>{{myReport.date}}</td>
                            <th class="info">Guard Name & ID</th>
                            <td>{{myReport.guard_name}}<br/>({{myReport.guard_id}})</td>

                        </tr>
                        </tbody>

                    </table>

                    <h4>Patrols</h4>
                    <table class="table table-bordered">
                        <thead>
                        <th class="info">Checkpoint ID</th>
                        <th class="info">Date</th>
                        <th class="info">Description</th>
                        </thead>
                        <tbody>

                        <tr ng-repeat="patrol in myReport.patrols">
                            <td>{{patrol.checkpoint_id}}</td>
                            <td>{{patrol.time}}</td>
                            <td>{{patrol.description}}</td>

                        </tr>

                        </tbody>

                    </table>
                    <h4>Incidents</h4>
                    <table class="table table-bordered">
                        <thead>
                        <th class="danger">Date</th>
                        <th class="danger">Severity</th>
                        <th class="danger">Description</th>
                        </thead>
                        <tbody>

                        <tr ng-repeat="incident in myReport.incident_reports">
                            <td>{{incident.time}}</td>
                            <td>{{incident.severity}}</td>
                            <td>{{incident.description}}</td>

                        </tr>

                        </tbody>

                    </table>
                    <h4>Parking Violation</h4>
                    <table class="table table-bordered">
                        <thead>
                        <th class="warning">Date</th>
                        <th class="warning">Description</th>
                        </thead>
                        <tbody>

                        <tr ng-repeat="park in myReport.parking_violations">
                            <td>{{park.time}}</td>
                            <td>{{park.description}}</td>


                        </tr>

                        </tbody>

                    </table>
                    <h4>Maintenance Calls</h4>
                    <table class="table table-bordered">
                        <thead>
                        <th class="danger">Date</th>
                        <th class="danger">Description</th>
                        </thead>
                        <tbody>

                        <tr ng-repeat="main in myReport.maintenance_calls">
                            <td>{{main.time}}</td>
                            <td>{{main.description}}</td>


                        </tr>

                        </tbody>

                    </table>
                    <h4>Call for Sevice</h4>
                    <table class="table table-bordered">
                        <thead>
                        <th class="success">Date</th>
                        <th class="success">>Description</th>
                        </thead>
                        <tbody>

                        <tr ng-repeat="service in myReport.calls_for_service">
                            <td>{{service.time}}</td>
                            <td>{{service.description}}</td>


                        </tr>

                        </tbody>

                    </table>
                </div>
            </div>

        </div>

        <div ng-show="tab === 5" class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <h1 class="page-header">Alerts</h1>

            <label>Building:
	    	  <span class="nullable">
	    	    <select ng-change="a_pickBuilding(a_selectedBuilding)" ng-model="a_selectedBuilding" ng-options="building.building_id  as building.name for building in a_buildings_search">
                    <option value="">--Please choose a building --</option>
                </select>
	    	    </span>
            </label>

            <label>Client:
	    	  <span class="nullable">
	    	    <select ng-change="a_pickClient(a_selectedClient)" ng-model="a_selectedClient" ng-options="client.client_id  as client.first_name+' '+client.last_name for client in a_clients_search">
                    <option value="">--Please choose a client --</option>
                </select>
	    	  </span>
            </label><br/>

            <label>Alert ID: <input ng-model="search2.report_item_id "></label>
            <label>Time: <input ng-model="search2.time "></label>
            <label>Severity: <input ng-model="search2.severity "></label>
            <label>Guard: <input ng-model="search2.guard_first_name "></label>


            <table class="table table-hover">
                <thead>
                <th>Alert ID</th>
                <th>Building</th>
                <th>DateTime</th>

                <th>Severity</th>
                <th>Guard</th>
                <th>Client</th>


                <tbody>
                <tr ng-repeat='item in pickedAlerts| filter:search2' ng-click='pickAlert(item)'>
                    <td>
                        {{item.report_item_id}}
                    </td>
                    <td>
                        {{item.name}}
                    </td>
                    <td>
                        {{item.time}}
                    </td>
                    <td>
                        {{item.severity}}
                    </td>
                    <td>
                        {{item.guard_first_name}}&nbsp {{item.guard_last_name}}
                    </td>
                    <td>
                        {{item.client_first_name}}&nbsp {{item.client_last_name}}
                    </td>

                </tr>
                </tbody>
            </table>
            <div ng-show="showAlert" class="panel panel-default">

                <div class="panel-body">
                    <span class="pull-right"><span ng-click="showAlert=false " class="glyphicon glyphicon-triangle-top"></span></span>

                    <h2>Alert</h2>

                    <p>The detail of the alert is as below:</p>
                    <table class="table table-bordered">

                        <tbody>
                        <tr>
                            <th class="danger">Alert ID</th>
                            <td>{{myAlert.report_item_id}}</td>
                        </tr>

                        <tr>
                            <th class="info">Building ID & Name</th>
                            <td>{{myAlert.building_id}}<br/>{{myAlert.name}}</td>
                        </tr>
                        <tr>
                            <th class="info">Guard ID & Name</th>
                            <td>{{myAlert.guard_id}}<br/>{{myAlert.guard_first_name}}&nbsp {{myAlert.guard_last_name}}
                            </td>
                        </tr>
                        <tr>
                            <th class="info">Client ID & Name</th>
                            <td>{{myAlert.client_id}}<br/>{{myAlert.client_first_name}}&nbsp {{myAlert.client_last_name}}
                            </td>
                        </tr>
                        <tr>
                            <th class="info">Severity</th>
                            <td>{{myAlert.severity}}</td>
                        </tr>
                        <tr>
                            <th class="info">Description</th>
                            <td>{{myAlert.description}}</td>
                        </tr>
                        <tr>
                            <th class="info">Date Time</th>
                            <td>{{myAlert.time}}</td>
                        </tr>

                        </tbody>

                    </table>


                </div>
            </div>

        </div>
    </div>
</div>

<script>
    var host = '';
    var app = angular.module('myApp', ['ngTable']);
    app.controller('AdminCtrl', function ($scope, $http, $filter, ngTableParams) {

        /*Clients Part*/

        $scope.getAllClients = function () {
            $scope.clientProfile = 0;
            $scope.clientBuildings = 0;
            $http.get(host + '/clients').success(function (res) {
                //alert(JSON.stringify(res));
                $scope.clients_data = res;
                $scope.tableParams = new ngTableParams({
                    page: 1,            // show first page
                    count: 10,          // count per page
                    filter: {
                        client_id: '1'       // initial filter
                    },
                    sorting: {
                        client_id: 'asc'     // initial sorting
                    }
                }, {
                    total: $scope.clients_data.length, // length of data
                    getData: function ($defer, params) {
                        // use build-in angular filter
                        $defer.resolve($scope.clients_data.slice((params.page() - 1) * params.count(), params.page() * params.count()));
                    }
                });
            });

            $scope.viewClient = function (user) {
                //$scope.clientProfile=!$scope.clientProfile;
                $scope.clientProfile = 1;
                $scope.clientBuildings = 0;
                $scope.client = user;
            };

            $scope.viewBuildings = function (user) {
                //$scope.clientProfile=!$scope.clientProfile;
                $scope.clientProfile = 0;
                $scope.clientBuildings = 1;

                $http.get(host + '/buildings').success(function (res) {
                    //alert(JSON.stringify(res));
                    $scope.buildings_data = $filter('filter')(res, {client_id: user.client_id});

                    $scope.TclientBuildings = new ngTableParams({
                        page: 1, // show first page
                        count: 5 // count per page
                    }, {
                        total: $scope.buildings_data.length, // length of data
                        getData: function ($defer, params) {
                            $defer.resolve($scope.buildings_data.slice((params.page() - 1) * params.count(), params.page() * params.count()));
                        }
                    });

                });

            };


            $scope.deleteClient = function (client_id, order) {
                if (confirm("Delete Client: " + client_id + "?")) {
                    $http({
                        method: 'DELETE',
                        url: host + '/clients/' + client_id
                        //  data: { "client_id": client_id}

                    }).success(function (res) {
                        if (res.status == 200) {
                            //alert("Delete Success!");
                            $scope.clients_data.splice(order, 1);
                        } else {
                            //alert("Delete Failed!");

                        }
                    });
                }
            };

        };

        /*Buildings Part*/

        $scope.getAllBuildings = function () {

            var loadBuildings = function () {
                $scope.buildingDetail = 0;
                //$scope.clientBuildings=0;
                $http.get(host + '/buildings').success(function (res) {
                    //alert(JSON.stringify(res));
                    $scope.AllBuildings_data = res;
                    $scope.tableBuildings = new ngTableParams({
                        page: 1,            // show first page
                        count: 10         // count per page
                    }, {
                        total: $scope.AllBuildings_data.length, // length of data
                        getData: function ($defer, params) {
                            // use build-in angular filter
                            $defer.resolve($scope.AllBuildings_data.slice((params.page() - 1) * params.count(), params.page() * params.count()));
                        }
                    });
                });

            };

            loadBuildings();

            $scope.showEditBuilding = function (user) {

                $http.get(host + '/clients').success(function (res) {
                    //alert(JSON.stringify(res));
                    $scope.clients = res;

                    var getIndexofClients = function (client_id, clients) {
                        for (var i = 0; i < clients.length; i++) {
                            if (clients[i]["client_id"] === client_id)
                                return i;
                        }
                        return -1;
                    };

                    //$scope.clientProfile=!$scope.clientProfile;
                    var x = getIndexofClients(user.client_id, $scope.clients);
                    $scope.buildingDetail = 1;
                    //$scope.clientBuildings=0;
                    $scope.building = user;
                    $scope.building.client_id = $scope.clients[x]["client_id"];
                    showBuilding($scope.building.address, $scope.building.check_points);


                });
            };

            $scope.deleteBuilding = function (building_id, order) {
                if (confirm("Delete Building: " + building_id + "?")) {
                    $http({
                        method: 'DELETE',
                        url: host + '/buildings/' + building_id
                        //data: { "building_id":building_id}

                    }).success(function (res) {
                        if (res.status == 200) {
                            //alert("Delete Success!");
                            $scope.AllBuildings_data.splice(order, 1);
                        } else {
                            //alert("Delete Failed!");

                        }
                    });
                }
            };

            $scope.createOrEditBuilding = function (id) {
                // alert(id);
                if (typeof id === "undefined") {
                    console.log($scope.building);
                    $scope.building.address = document.getElementById('address').value;
                    $scope.building.location = document.getElementById('location').value;
                    $scope.building.check_points = document.getElementById('checkpoints').value;
//                    $scope.building.check_points = JSON.stringify(checkPoints);
                    $http({
                        method: 'POST',
                        url: host + '/buildings',
                        data: $scope.building

                    }).success(function (res) {
                        if (res.status == 201) {
                            //alert("Create Success!");
                            loadBuildings();
                        } else {
                            //alert("Create Failed!");

                        }
                    });

                } else {
                    $http({
                        method: 'POST',
                        url: host + '/buildings/' + id + '/update',
                        data: $scope.building

                    }).success(function (res) {
                        if (res.status == 200) {
                            //alert("Edit Success!");
                            loadBuildings();
                        } else {
                            //alert("Edit Failed!");
                            loadBuildings();

                        }
                    });
                }
            };

            $scope.showCreateBuilding = function () {
                $http.get(host + '/clients').success(function (res) {
                    //alert(JSON.stringify(res));
                    $scope.clients = res;
                });
                $scope.building = {};
                $scope.buildingDetail = 1;
            };
        };

        /*Guards Part*/

        $scope.getAllGuards = function () {
            $scope.guardDetail = 0;
            $scope.assignBuildingToGuard = 0;
            $http.get(host + '/guards').success(function (res) {
                //alert(JSON.stringify(res));
                $scope.guards_data = res;
                $scope.tableGuards = new ngTableParams({
                    page: 1,            // show first page
                    count: 10          // count per page

                }, {
                    total: $scope.guards_data.length, // length of data
                    getData: function ($defer, params) {
                        // use build-in angular filter

                        $defer.resolve($scope.guards_data.slice((params.page() - 1) * params.count(), params.page() * params.count()));
                    }
                });
            });

            $scope.viewGuard = function (user) {
                //$scope.clientProfile=!$scope.clientProfile;
                $scope.guardDetail = 1;
                $scope.assignBuildingToGuard = 0;
                $scope.guard = user;
                $http({
                    method: 'GET',
                    url: host + '/guards/' + user.guard_id + '/schedule'
                    //  params: {"guard_id":user.guard_id}

                }).success(function (res) {
                    //if(res.status==200){
                    $scope.guardBuilding_data = res.schedule;
//                    console.log(JSON.stringify(res));
                    //alert("Create Success!");
                    //loadBuildings();
                    /*	}else{
                     //alert("Failed!");

                     }		*/
                });
            };

            $scope.assignBuildings = function (user) {

                $scope.assignBuildingToGuard = 1;
                $scope.guardDetail = 0;
                $scope.guard = user;
                $http.get(host + '/buildings').success(function (res) {
                    //alert(JSON.stringify(res));
                    $scope.assign_buildings = res;
                });
                $scope.weekdays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];


            };


            $scope.assign = function (guard_id) {
                $http({
                    method: 'POST',
                    url: host + '/guards/' + guard_id + '/schedule',
                    data: {"guard_id": guard_id, "assign": $scope.assign}

                }).success(function (res) {
                    if (res.status == 201) {
                        //alert("Create Schedule Success!");
                        //$scope.guards_data.splice(order,1);
                    } else {
                        //alert("Create Schedule Failed!");

                    }
                });
            };


            $scope.deleteGuard = function (guard_id, order) {
                if (confirm("Delete Guard: " + guard_id + "?")) {
                    $http({
                        method: 'DELETE',
                        url: host + '/guards/' + guard_id
                        //  data: { "client_id": client_id}

                    }).success(function (res) {
                        if (res.status == 200) {
                            //alert("Delete Success!");
                            $scope.guards_data.splice(order, 1);
                        } else {
                            //alert("Delete Failed!");

                        }
                    });
                }
            };

        };

        /*Reports Part*/
        $scope.getAllReports = function () {
            $scope.showReport = false;
            $http.get(host + '/clients').success(function (res) {
                //alert(JSON.stringify(res));
                $scope.r_clients_search = res;
            });
            $http.get(host + '/buildings').success(function (res) {
                //alert(JSON.stringify(res));
                $scope.r_buildings_search = res;
            });

            $scope.pickBuilding = function (index) {
                //alert(index);
                if ($scope.selectedClient !== null)
                    $scope.selectedClient = null;
                $http.get(host + '/reports/list?building_id=' + index).success(function (res) {
                    //alert(JSON.stringify(res));
                    $scope.pickedReports = res;
                    console.log(res);
                });
            };

            $scope.pickClient = function (index) {
                //alert(index);
                if ($scope.selectedBuilding !== null)
                    $scope.selectedBuilding = null;
                $http.get(host + '/reports/list?client_id=' + index).success(function (res) {
                    $scope.pickedReports = res;
                    console.log(res);
                });
            };

            $scope.getReport = function (report) {

                //has to change here
                $http.get(host + '/reports/' + report.report_id).success(function (res) {
                    //alert(JSON.stringify(res));
                    $scope.showReport = true;
                    console.log(res);
                    $scope.myReport = res;
                    $scope.myReport.guard_name = report.first_name + " " + report.last_name;
                    $scope.myReport.building_name = report.name;
                });
            };
        };

        /*Alerts Part*/
        $scope.getAllAlerts = function () {
            $scope.showAlert = false;
            $scope.search2 = [];
            $http.get(host + '/clients').success(function (res) {
                //alert(JSON.stringify(res));
                $scope.a_clients_search = res;


            });
            $http.get(host + '/buildings').success(function (res) {
                //alert(JSON.stringify(res));
                $scope.a_buildings_search = res;


            });

            $scope.a_pickBuilding = function (index) {
                // alert(index);
                if ($scope.a_selectedClient !== null)
                    $scope.a_selectedClient = null;
                $http.get(host + '/alerts?building_id=' + index).success(function (res) {
                    $scope.showAlert = false;
                    //alert(JSON.stringify(res));
                    $scope.pickedAlerts = res;
                    console.log(res);
                });
            };

            $scope.a_pickClient = function (index) {
                //  alert(index);
                if ($scope.a_selectedBuilding !== null)
                    $scope.a_selectedBuilding = null;
                $http.get(host + '/alerts?client_id=' + index).success(function (res) {
                    $scope.showAlert = false;
                    //alert(JSON.stringify(res));
                    $scope.pickedAlerts = res;
                    console.log(res);
                });
            };

            $scope.pickAlert = function (item) {


                // $http.get(host + '/alerts/'+index).success(function(res) {
                //alert(JSON.stringify(res));
                $scope.showAlert = true;
                $scope.myAlert = item;
                console.log(res);
                // });
            };
        };

        /*end*/
    });
</script>

<!-- Bootstrap core JavaScript
  ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/javascripts/jquery.min.js"></script>
<!--<script src="../public/javascripts/jquery.min.js"></script>-->

<script src="/javascripts/bootstrap.min.js"></script>
<!--<script src="../public/javascripts/bootstrap.min.js"></script>-->

<!-- Just to make our placeholder images work. Don't actually copy the next line! -->
<script src="/javascripts/holder.js"></script>
<!--<script src="../public/javascripts/holder.js"></script>-->

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="/javascripts/ie10-viewport-bug-workaround.js"></script>
<!--<script src="../public/javascripts/ie10-viewport-bug-workaround.js"></script>-->

</body>

</html>